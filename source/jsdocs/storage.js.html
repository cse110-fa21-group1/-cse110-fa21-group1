<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>storage.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <li class="nav-link nav-home-link"><a href="index.html">Home</a></li><li class="nav-heading">Classes</li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Recipe.html">Recipe</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="RecipeCard.html">RecipeCard</a></span></li><li class="nav-heading"><a href="global.html">Globals</a></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#addNavigation">addNavigation</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#addSearchFunction">addSearchFunction</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#fetchRecipes">fetchRecipes</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#fetchRecipesHelper">fetchRecipesHelper</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#init">init</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#isEdit">isEdit</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#isSearched">isSearched</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#moveToPage">moveToPage</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#newIng">newIng</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#newInstr">newInstr</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#openHamburgerMenu">openHamburgerMenu</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#populateBaseline">populateBaseline</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#populateCards">populateCards</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#populateRecipe">populateRecipe</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#populateRecipeHelper">populateRecipeHelper</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#setTimerText">setTimerText</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#startTimer">startTimer</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#youtubeID">youtubeID</a></span></li>
</nav>

<div id="main">
    
    <h1 class="page-title">storage.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>// storage.js

export const storage = {};

/** Initialize localstorage for counting recipes created */
storage.init = () => {
  // Initialize our recipe count for generating IDs
  if (localStorage.getItem('numRecipesCreated') == undefined ||
      localStorage.getItem('numRecipesCreated') == 'NaN') {
    localStorage.setItem('numRecipesCreated', '0');
    localStorage.setItem('pinned', '[]');
  }
//   if (localStorage.getItem('pinned') == undefined ||
//       localStorage.getItem('pinned') == 'NaN') {
//     localStorage.setItem('pinned', '[]');
//     console.log('here');
//   }
};

/** Increase number of recipes created, mainly for creating id */
storage.increaseCount = () => {
  const newCount = (storage.currentCount()+1).toString();
  localStorage.setItem('numRecipesCreated', newCount);
};

/**
 * Return number of recipes created
 * @return {Int} Number of recipes created
 */
storage.currentCount = () => {
  return parseInt(localStorage.getItem('numRecipesCreated'));
};

/**
 * Return generated recipe id for new recipe
 * @return {String} Generated recipe id for new recipe
 */
storage.generateNewId = () => {
  // Increase accumulating count for generating id
  storage.increaseCount();
  // Format: 7-digit number
  // 0000001, 0000002, 0000003, ...
  // Current limit is up to 9999999
  return ('000000'+storage.currentCount()).slice(-7);
};

/**
 * Return an array of all saved recipes
 * @return {Array} An array of all saved recipes' id
 */
storage.getRecipes = () => {
  const ids = storage.getRecipeIDs();
  return ids.map((id) => storage.getRecipe(id)) || [];
};

/**
 * Adds a recipe to storage
 * @param {Recipe} recipe recipe in json format
 * @return {String} id of the new recipe
 */
storage.addRecipe = function(recipe) {
  // Get current recipes
  const currRecipes = storage.getRecipeIDs();
  // Add recipe to recipes
  recipe.id = storage.generateNewId();
  currRecipes.push(recipe.id);
  localStorage.setItem('recipes', JSON.stringify(currRecipes));
  localStorage.setItem(recipe.id, JSON.stringify(recipe));
  return recipe.id;
};

/**
 * Return the index of a recipe with a given id
 * @param {Int} id ID of the reicipe to be searched
 * @return {Int} index of the recipe
 */
storage.getRecipeIndex = function(id) {
  const currRecipeIDs = storage.getRecipeIDs();
  return currRecipeIDs.indexOf(id);
};

/**
 * Removes a recipe from our recipes
 * @param {String} id ID of a recipe
 */
storage.removeRecipe = function(id) {
  // Get the current recipes
  const currRecipes = storage.getRecipes();
  // Get the index of the recipe to remove
  const indexOfId = storage.getRecipeIndex(id);
  // Remove the recipe
  if (indexOfId > -1) currRecipes.splice(indexOfId, 1);
  localStorage.setItem('recipes', JSON.stringify(currRecipes));
  localStorage.removeItem(id);
};

/**
 * Update the recipe, match using id
 * @param {Recipe} recipe The updated version of the recipe
 * @return {String} id of the reciped being edited
 */
storage.editRecipe = function(recipe) {
  // Get the index of the recipe to remove
  const indexOfId = storage.getRecipeIndex(recipe.id);
  // Error checking - if the recipe is actually new but not editing an old one
  if (indexOfId &lt; 0) {
    const newId = storage.addRecipe(recipe);
    return newId;
  } else {
    localStorage.setItem(recipe.id, JSON.stringify(recipe));
    return recipe.id;
  }
};

/**
 * Get recipe info with id
 * @param {String} id id of the recipe
 * @return {Recipe} requestedrecipe object
 */
storage.getRecipe = function(id) {
  return JSON.parse(localStorage.getItem(id)) || {};
};

/**
 * Return a set of recipe ids in localstorage
 * @return {Array} List of recipe ids in localstorage
 */
storage.getRecipeIDs = function() {
  return JSON.parse(localStorage.getItem('recipes')) || [];
};

/**
 * Pin recipe with given id
 * @param {String} id id of the recipe to be pinned
 */
storage.pinRecipe = function(id) {
  if (storage.getRecipeIndex(id) != -1) {
    const recipe = JSON.parse(localStorage.getItem(id));
    recipe.pinned = true;
    storage.editRecipe(recipe);
  }
  const pinnedRecipe = JSON.parse(localStorage.getItem('pinned'));
  pinnedRecipe.push(id);
  localStorage.setItem('pinned', JSON.stringify(pinnedRecipe));
};

/**
 * Unpin recipe with given id
 * @param {String} id id of the recipe to be unpinned
 */
storage.unpinRecipe = function(id) {
  if (storage.getRecipeIndex(id) != -1) {
    const recipe = JSON.parse(localStorage.getItem(id));
    recipe.pinned = false;
    storage.editRecipe(recipe);
  }
  const pinnedRecipe = JSON.parse(localStorage.getItem('pinned'));
  const index = pinnedRecipe.indexOf(id);
  if (index > -1) {
    pinnedRecipe.splice(index, 1);
  }
  localStorage.setItem('pinned', JSON.stringify(pinnedRecipe));
};

/**
 * Check if a recipe is pinned
 * @param {String} id id of the recipe to be checked
 * @return {Boolean} whether recipe is pinned
 */
storage.isPinned = function(id) {
  const pinnedRecipe = JSON.parse(localStorage.getItem('pinned')) || [];
  for (let i = 0; i &lt; pinnedRecipe.length; i++) {
    if (pinnedRecipe[i] == id) {
      return true;
    }
  }
  return false;
};

/**
 * Return a list of pinned recipe ids
 * @return {Array} List of pinned recipe ids
 */
storage.getPinnedRecipes = function() {
  // const ids = storage.getRecipeIDs();
  // return ids.filter((id) => storage.isPinned(id)) || [];
  return JSON.parse(localStorage.getItem('pinned'));
};

/**
 * Save search result for later use
 * @param {String} result Search result in json format
 */
storage.setSearchedRecipes = function(result) {
  // Result - from json to Object
  const recipes = JSON.parse(result);
  const recipesFormatted = [];
  // For each recipes searched
  // Reason for this formatting loop is that
  // Spoonacular doesn't follow the standard Google json format
  for (let i = 0; i &lt; recipes.length; i++) {
    // Format from Spoonacular format into the standard format
    const recipe = storage.formatRecipe(recipes[i]);
    // Push formatted recipe
    recipesFormatted.push(recipe);
  }
  // Save all formatted recipes (as Json String)
  localStorage.setItem('searchRecipes', JSON.stringify(recipesFormatted));
};

/**
 * Return recipe from search results
 * @param {id} id Id of the target recipe
 * @return {Recipe} recipe queried
 */
storage.getSearchedRecipe = function(id) {
  const currRecipes = JSON.parse(localStorage.getItem('searchRecipes'));
  for (let i = 0; i &lt; currRecipes.length; i++) {
    // Get recipe by comparing ids
    if (currRecipes[i].id == id) {
      return currRecipes[i];
    }
  }
  return {};
};

/**
 * Return recipes from search results
 * @return {Recipe} recipes in latest search
 */
storage.getSearchedRecipes = function() {
  return JSON.parse(localStorage.getItem('searchRecipes'));
};

/**
 * Return formatted recipe
 * @param {Recipe} recipe Recipe from Spoonacular
 * @return {Recipe} formatted recipe
 */
storage.formatRecipe = function(recipe) {
  // Recipe holder
  const formatted = {};
  // Recipe title
  formatted.name = recipe['title'];
  // Recipe thumbnail
  formatted.image = recipe['image'];
  // Recipe description
  formatted.description = recipe['summary'];
  // Recipe cook time
  formatted.totalTime = 'PT' +
    Math.floor(recipe['readyInMinutes']/60) + 'H' +
    (recipe['readyInMinutes']%60) + 'M';
  // Recipe servings
  formatted.recipeYield = recipe['servings'];
  // Recipe ingredients
  formatted.recipeIngredient = [];
  for (let j = 0; j &lt; (recipe['extendedIngredients']).length; j++) {
    const ing = recipe['extendedIngredients'][j]['name'];
    formatted.recipeIngredient.push(ing);
  }
  // Recipe insturctions
  formatted.recipeInstruction = [];
  const majorInstrCount = (recipe['analyzedInstructions']).length;
  for (let i = 0; i &lt; majorInstrCount; i++) {
    // The short summary of the following steps
    const majorInstr = recipe['analyzedInstructions'][i]['name'];
    if (majorInstr != '') {
      // If we have major summarized instructions for the small steps
      formatted.recipeInstruction.push(majorInstr + ':');
    }
    const instrCount = (recipe['analyzedInstructions'][i]['steps']).length;
    // Pad two spaces in front if it is summarized into a major instruction
    const paddingSpace = (majorInstr != '') ? '--> ' : '';
    for (let j = 0; j &lt; instrCount; j++) {
      // Detailed steps of the instruction
      const step = recipe['analyzedInstructions'][i]['steps'][j]['step'];
      formatted.recipeInstruction.push(paddingSpace + step);
    }
  }
  // Recipe id (from spoonacular)
  formatted.id = recipe['id'];
  formatted.pin = false;

  return formatted;
};

/**
 * Reset localstorage
 */
storage.reset = function() {
  // Clear everything in the localstorage
  localStorage.clear();
};
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.4</a> on Wed Dec 01 2021 03:21:05 GMT+0000 (Coordinated Universal Time) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
